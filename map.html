<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
	<title>DC.js + Leaflet</title>

	<meta itemprop="name" content="DC.js + Leaflet"/>
	<meta itemprop="description" content="DC.js + Leaflet chart"/>

	<meta charset="UTF-8">

	<link type="text/css" href="lib/leaflet.css" rel="stylesheet"/>
	<link type="text/css" href="lib/leaflet.markercluster.css" rel="stylesheet"/>
	<link type="text/css" href="lib/dc.css" rel="stylesheet"/>

  <style>
    #holder {
      width:850px;
      margin:20px auto;
    }
    #holder>div {
      padding:30px 0;
      clear:both;
    }
    .map {
      width:600px;
      height:400px;
    }
    .pie {
      margin-left:30px;
    }
  </style>
</head>
<body>

<div id="holder">
  <div id="demo1">
    <h2>Hotel in Singapore</h2>
    <div class="map"></div>
    <div class="pie">
	</div>
	<span>Pie Chart - room count (S:100, M:300, L:300+)<br>
	</span>
	
  </div>




</div>

<script type="text/javascript" src="lib/d3.js"></script>
<script type="text/javascript" src="lib/crossfilter.js"></script>
<script type="text/javascript" src="lib/dc.js"></script>
<script type="text/javascript" src="lib/leaflet.js"></script>

<!--Optional-->
<script type="text/javascript" src="lib/leaflet.markercluster.js"></script>

<script type="text/javascript" src="dc.leaflet.js"></script>
<script type="text/javascript">

/*     Markers      */
var inputFile1 = 'hotelsg.tsv';
var inputFile2 = "demo1.tsv";
d3.tsv(inputFile1, function(data) {
  drawMarkerSelect(data);
  drawMarkerArea(data);
});

function drawMarkerSelect(data) {
  var xf = crossfilter(data);
  var groupname = "marker-select";
	var facilities = xf.dimension(function(d) { return d.geo; });
	var facilitiesGroup = facilities.group().reduceCount();

  dc.leafletMarkerChart("#demo1 .map",groupname)
      .dimension(facilities)
      .group(facilitiesGroup)
      .width(800)
	    .height(1400)
      .center([1.35,103.8198])
      .zoom(12)
      .cluster(true);  

	var types = xf.dimension(function(d) { return d.type; });
	var typesGroup = types.group().reduceCount();

  dc.pieChart("#demo1 .pie",groupname)
      .dimension(types)
      .group(typesGroup)
      .width(200)
	    .height(200)
	    .renderLabel(true)
	    .renderTitle(true)
      .ordering(function (p) {
        return -p.value;
      });

	dc.renderAll(groupname);
}

function drawMarkerArea(data) {
  var xf = crossfilter(data);
  var groupname = "marker-area";
	var facilities = xf.dimension(function(d) { return d.geo; });
	var facilitiesGroup = facilities.group().reduceCount();

  dc.leafletMarkerChart("#demo2 .map",groupname)
      .dimension(facilities)
      .group(facilitiesGroup)
      .width(600)
	    .height(400)
      .center([1.35,103.8198])
      .zoom(12)
      .renderPopup(false)
      .filterByArea(true);  

	var types = xf.dimension(function(d) { return d.type; });
	var typesGroup = types.group().reduceCount();

  dc.pieChart("#demo2 .pie",groupname)
      .dimension(types)
      .group(typesGroup)
      .width(200)
	    .height(200)
	    .renderLabel(true)
	    .renderTitle(true)
      .ordering(function (p) {
        return -p.value;
      });

	dc.renderAll(groupname);
}




</script>


</body>
</html>
